import { useState, useEffect } from 'react';

export default function SimpleVirtualPointFinder() {
  // Grid size for our virtual space
  const GRID_SIZE = 300;
  const CELL_SIZE = 30;
  
  // User and point positions
  const [userPosition, setUserPosition] = useState({ x: 5, y: 5 });
  const [pointPosition, setPointPosition] = useState({ x: 8, y: 3 });
  const [direction, setDirection] = useState('');
  
  // Move the user position with arrow keys
  useEffect(() => {
    const handleKeyPress = (e) => {
      switch(e.key) {
        case 'ArrowUp':
          setUserPosition(prev => ({ ...prev, y: Math.max(0, prev.y - 1) }));
          break;
        case 'ArrowDown':
          setUserPosition(prev => ({ ...prev, y: Math.min(9, prev.y + 1) }));
          break;
        case 'ArrowLeft':
          setUserPosition(prev => ({ ...prev, x: Math.max(0, prev.x - 1) }));
          break;
        case 'ArrowRight':
          setUserPosition(prev => ({ ...prev, x: Math.min(9, prev.x + 1) }));
          break;
        default:
          break;
      }
    };
    
    window.addEventListener('keydown', handleKeyPress);
    return () => window.removeEventListener('keydown', handleKeyPress);
  }, []);
  
  // Move the virtual point randomly every few seconds
  useEffect(() => {
    const intervalId = setInterval(() => {
      setPointPosition({
        x: Math.floor(Math.random() * 10),
        y: Math.floor(Math.random() * 10)
      });
    }, 3000);
    
    return () => clearInterval(intervalId);
  }, []);
  
  // Calculate direction to point whenever positions change
  useEffect(() => {
    // Calculate direction from user to point
    const dx = pointPosition.x - userPosition.x;
    const dy = pointPosition.y - userPosition.y;
    
    // Determine primary direction (N, S, E, W)
    let newDirection = '';
    
    if (Math.abs(dy) > Math.abs(dx)) {
      // Vertical movement is stronger
      newDirection = dy < 0 ? 'North' : 'South';
      if (Math.abs(dx) > 0.3 * Math.abs(dy)) {
        // Add secondary direction
        newDirection += dx < 0 ? 'west' : 'east';
      }
    } else {
      // Horizontal movement is stronger
      newDirection = dx < 0 ? 'West' : 'East';
      if (Math.abs(dy) > 0.3 * Math.abs(dx)) {
        // Add secondary direction
        newDirection = (dy < 0 ? 'North' : 'South') + newDirection.toLowerCase();
      }
    }
    
    // If we're at the same position
    if (dx === 0 && dy === 0) {
      newDirection = 'You found it!';
    }
    
    setDirection(newDirection);
  }, [userPosition, pointPosition]);
  
  // Draw the grid with the user and point positions
  const renderGrid = () => {
    const grid = [];
    
    for (let y = 0; y < 10; y++) {
      const row = [];
      for (let x = 0; x < 10; x++) {
        const isUser = userPosition.x === x && userPosition.y === y;
        const isPoint = pointPosition.x === x && pointPosition.y === y;
        
        let cellContent = '·';
        let cellClass = 'flex items-center justify-center bg-gray-100';
        
        if (isUser && isPoint) {
          cellContent = '★';
          cellClass = 'flex items-center justify-center bg-purple-300 font-bold';
        } else if (isUser) {
          cellContent = '⬤';
          cellClass = 'flex items-center justify-center bg-blue-300';
        } else if (isPoint) {
          cellContent = '✦';
          cellClass = 'flex items-center justify-center bg-yellow-200';
        }
        
        row.push(
          <div 
            key={`${x}-${y}`} 
            className={`${cellClass} w-8 h-8 border border-gray-300`}
          >
            {cellContent}
          </div>
        );
      }
      grid.push(
        <div key={y} className="flex">
          {row}
        </div>
      );
    }
    
    return grid;
  };

  // Create buttons for mobile users
  const handleButtonPress = (direction) => {
    switch(direction) {
      case 'up':
        setUserPosition(prev => ({ ...prev, y: Math.max(0, prev.y - 1) }));
        break;
      case 'down':
        setUserPosition(prev => ({ ...prev, y: Math.min(9, prev.y + 1) }));
        break;
      case 'left':
        setUserPosition(prev => ({ ...prev, x: Math.max(0, prev.x - 1) }));
        break;
      case 'right':
        setUserPosition(prev => ({ ...prev, x: Math.min(9, prev.x + 1) }));
        break;
      default:
        break;
    }
  };
  
  return (
    <div className="flex flex-col items-center justify-center p-4 max-w-md mx-auto">
      <h1 className="text-xl font-bold mb-2">Simple Virtual Point Finder</h1>
      <p className="text-sm mb-4">Move with arrow keys or buttons to find the virtual point</p>
      
      <div className="mb-4">
        <div className="text-center font-medium mb-2">
          Compass: <span className="text-blue-600">{direction}</span>
        </div>
        
        <div className="border border-gray-400 p-1 bg-gray-50">
          {renderGrid()}
        </div>
        
        <div className="text-xs text-gray-600 mt-2">
          <div>⬤ = You</div>
          <div>✦ = Virtual point</div>
        </div>
      </div>
      
      {/* Controls for mobile users */}
      <div className="grid grid-cols-3 gap-1 w-32 mt-4">
        <div></div>
        <button 
          onClick={() => handleButtonPress('up')}
          className="bg-gray-200 p-2 rounded text-center flex items-center justify-center"
        >
          ▲
        </button>
        <div></div>
        
        <button 
          onClick={() => handleButtonPress('left')}
          className="bg-gray-200 p-2 rounded text-center flex items-center justify-center"
        >
          ◄
        </button>
        <div></div>
        <button 
          onClick={() => handleButtonPress('right')}
          className="bg-gray-200 p-2 rounded text-center flex items-center justify-center"
        >
          ►
        </button>
        
        <div></div>
        <button 
          onClick={() => handleButtonPress('down')}
          className="bg-gray-200 p-2 rounded text-center flex items-center justify-center"
        >
          ▼
        </button>
        <div></div>
      </div>
    </div>
  );
}
